<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>


    <script>

        // async/await — JavaScript-də Promise-lər üzərində işləməyi daha sadə və oxunaqlı edən sintaksisdir.
        // Bu ES8 (ES2017)-də əlavə olunub və əsas məqsədi asinxron kodu sinxron kod kimi yazmaqdır.



        // async funksiyası nə edir?
        // - Bir funksiyanı async açar sözü ilə işarələsəniz, o funksiya həmişə Promise qaytarır.
        // - Əgər həmin funksiya içində sadə bir dəyər qaytarsanız, o avtomatik Promise.resolve(dəyər)-ə çevrilir.










        // Burada hello() Promise qaytarır, ona görə .then() istifadə edə bilirik.
        async function hello() {
            return "Salam";
        }

        hello().then(msg => console.log(msg)); // Salam






        // await nə edir? (Ən vacib hissə)
        // await — yalnız async funksiyanın içində işləyə bilər və Promise-in nəticəsini gözləmək üçün istifadə olunur.

        // Sadə dillə desək:
        // - await deyəndə, JavaScript həmin Promise tam həll olunana qədər (resolved) dayanır və nəticəni götürür.
        // - Kod həmin sətirdə "pauza" verir, amma digər kodlar (event loop) işləməyə davam edir — yəni bütün proqram donmur.
        // - Məsələn: await, ən əsas APİ ilə datalar çəkdiyimiz zaman, həmin datalar yüklənənə qədər kodun bir hissəsini gözləməyə məcbur etmək üçün istifadə edilə bilər.









        // Burada await delay(2000) deyəndə:
        //      - delay(2000) Promise qaytarır.
        //      - await deyir ki: “Bu Promise bitənə qədər gözlə və nəticəni götür”.
        //      - 2 saniyə keçəndən sonra davam edir.
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        async function run() {
            console.log("Başladı");
            await delay(2000); // 2 saniyə gözləyir
            console.log("2 saniyə sonra davam etdi");
        }

        run();




















        // await Promise qaytarmayan dəyərlərlə
        // Əgər await-in qarşısında Promise yox, sadə dəyər varsa, həmin dəyər Promise.resolve(dəyər) kimi qəbul olunur.
        async function test() {
            let x = await 5;
            console.log(x); // 5    - Burada heç gözləmə yoxdur, çünki dəyər dərhal hazırdır.
        }
        test();

























        // async & await ilə API nümunəsi
        async function getUser() {
            try {
                const response = await fetch("https://jsonplaceholder.typicode.com/users/1");
                const user = await response.json();
                console.log("İstifadəçi:", user.name);
            } catch (error) {
                console.error("Xəta baş verdi:", error);
            }
        }
        getUser();

        // Burada:
        //      - await fetch(...) → API cavabını gözləyir.
        //      - await response.json() → JSON parsinqini gözləyir.
        //      - try/catch ilə xətaları idarə edirik.













        // await olmadan eyni kod necə görünərdi        
        fetch("https://jsonplaceholder.typicode.com/users/1")
            .then(response => response.json())
            .then(user => console.log("İstifadəçi:", user.name))
            .catch(error => console.error("Xəta baş verdi:", error));

        // Göründüyü kimi, async/await kodu daha oxunaqlı edir.










        // await ilə paralel işlər
        // Əgər əməliyyatlar bir-birindən asılı deyilsə, onları paralel aparmaq üçün Promise.all ilə birlikdə 
        // istifadə etmək lazımdır: Əks halda await hər əməliyyatı ardıcıllıqla edəcək və vaxt çox çəkəcək.
        async function runParallel() {
            const promise1 = fetch("https://jsonplaceholder.typicode.com/users/1");
            const promise2 = fetch("https://jsonplaceholder.typicode.com/users/2");

            const [user1, user2] = await Promise.all([promise1, promise2]);

            console.log("User1 status:", user1.status);
            console.log("User2 status:", user2.status);
        }

        runParallel();













        // await-in məhdudiyyətləri
        //      - Yalnız async funksiya içində istifadə olunur (top-level await ES2022-də gəlir, amma hər yerdə dəstəklənmir).
        //      - Kodun ardıcıl icrasını “pauza” edir, buna görə bəzən performans üçün Promise.all daha yaxşıdır.
    </script>
</body>

</html>